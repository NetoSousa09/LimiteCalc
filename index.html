<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LimitCalc</title>
  <style>
    body{font-family:Arial,sans-serif;background:#f4f4f4;margin:0;color:#333}
    .container{max-width:500px;margin:20px auto;background:white;min-height:100vh;border-radius:20px;box-shadow:0 0 20px rgba(0,0,0,.1);padding-bottom:30px}
    header{background:#00bd56;color:white;text-align:center;padding:30px;font-size:38px;font-weight:bold}
    header span{font-size:55px;color:#000}
    #circle{width:320px;height:320px;margin:40px auto;border-radius:50%;border:30px solid #4CAF50;position:relative;background:#fff;box-shadow:0 0 25px rgba(0,0,0,.15)}
    #progress{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:72px;font-weight:bold;color:#00bd56}
    .btn{padding:18px 32px;margin:15px;font-size:22px;border:none;border-radius:15px;cursor:pointer;box-shadow:0 5px 15px rgba(0,0,0,.2);width:90%;max-width:400px}
    .btn-primary{background:#00bd56;color:white}
    .btn-capture{background:#007bff;color:white}
    .btn-whatsapp{background:#25D366;color:white}
    .item{padding:18px;border-bottom:1px solid #eee;display:flex;justify-content:space-between;align-items:center;font-size:20px}
    .delete{color:red;font-size:28px;cursor:pointer}
    #limitDiv{text-align:center;padding:20px}
    #limitDiv input{padding:15px;font-size:24px;width:200px;border-radius:12px;border:2px solid #ddd;margin:10px}
    #botoesFinais{display:none;justify-content:center;gap:20px;margin:30px;flex-wrap:wrap}
    #listaModal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.95);z-index:999;justify-content:center;align-items:center;padding:20px}
    .modal-content{background:white;border-radius:20px;padding:30px;max-width:90%;max-height:90%;overflow-y:auto;text-align:center}
    .modal-content h2{font-size:36px;color:#00bd56;margin:10px}
    .lista-item{font-size:22px;padding:12px 0;border-bottom:1px solid #eee}
    .total{font-size:30px;font-weight:bold;color:#00bd56;margin:25px 0}
  </style>
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4.0.2/dist/tesseract.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.12/pdfmake.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.12/vfs_fonts.js"></script>
</head>
<body>
  <div class="container">
    <header>LimitCalc <span>Cart</span></header>
    
    <div id="limitDiv">
      <input type="number" id="limite" placeholder="Seu limite R$" step="0.01">
      <button class="btn btn-primary" onclick="definirLimite()">Definir Limite</button>
    </div>

    <div id="circle"><div id="progress">R$ 0,00</div></div>

    <div style="text-align:center">
      <button class="btn btn-capture" onclick="iniciarCaptura()">Capturar Etiqueta</button>
      <button class="btn btn-primary" onclick="abrirTeclado()">Adicionar Manual</button>
    </div>

    <div id="listaItens" style="margin:20px"></div>

    <div id="botoesFinais">
      <button class="btn btn-primary" onclick="abrirListaModal()">Visualizar Lista Completa</button>
    </div>
  </div>

  <!-- Modal Lista + PDF + WhatsApp -->
  <div id="listaModal" onclick="if(event.target===this)fecharListaModal()">
    <div class="modal-content">
      <h2>LimitCalc</h2>
      <h3>Lista de Compras</h3>
      <div id="listaModalItens"></div>
      <div class="total" id="totalModal"></div>
      <p><em>Data: <span id="dataAtual"></span></em></p>
      <button class="btn btn-primary" onclick="baixarPDF()">Salvar em PDF</button>
      <button class="btn btn-whatsapp" onclick="compartilharWhats()">Compartilhar no WhatsApp</button>
      <button class="btn" style="background:#ccc;color:#333" onclick="fecharListaModal()">Fechar</button>
    </div>
  </div>

  <script>
    let limite=0,total=0,itens=[];

    if(localStorage.limitCalc){
      const d=JSON.parse(localStorage.limitCalc);
      limite=d.limite||0; total=d.total||0; itens=d.itens||[];
      atualizarTudo();
    }

    function definirLimite(){
      limite=parseFloat(document.getElementById('limite').value)||0;
      salvar(); atualizarTudo();
    }

    function atualizarTudo(){
      document.getElementById('progress').innerText=`R$ ${total.toFixed(2).replace('.',',')}`;
      const perc=limite>0?total/limite*100:0;
      let cor='#4CAF50';
      if(perc
