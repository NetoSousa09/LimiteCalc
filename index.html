<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>LimiteCalc</title>
  <style>
    :root {
      --green: #18a558;
      --yellow: #f5a623;
      --red: #d0021b;
      --bg: #f7f7f9;
      --text: #222;
      --muted: #666;
      --card: #fff;
      --border: #ddd;
      --accent: #2b3a67;
    }
    body { margin:0; font-family:system-ui; background:var(--bg); color:var(--text); display:flex; flex-direction:column; min-height:100vh; }
    .container { max-width:720px; margin:0 auto; padding:12px; width:100%; }
    header { text-align:center; padding:8px 0 4px; }
    .title { display:inline-flex; align-items:center; gap:10px; font-weight:800; font-size:2rem; }
    .cart-icon svg { width:40px; height:40px; fill:#000; }
    .total-line { margin-top:6px; font-size:1.125rem; font-weight:700; }
    .limit-area { display:grid; grid-template-columns:1fr 1fr; gap:12px; margin:12px 0; }
    .card { background:var(--card); border:1px solid var(--border); border-radius:12px; padding:12px; }
    .card-title { font-weight:700; color:var(--green); margin-bottom:8px; }
    .limit-input { width:100%; max-width:120px; font-size:1.25rem; padding:8px; border:1px solid var(--border); border-radius:10px; text-align:center; }
    .progress-bar { width:100%; height:16px; background:#e9e9ef; border-radius:10px; overflow:hidden; border:1px solid var(--border); }
    .progress-fill { height:100%; width:0%; background:var(--green); transition:width 200ms ease, background-color 200ms ease; }
    .inputs-row { display:grid; grid-template-columns:7fr 3fr; gap:12px; margin-bottom:10px; }
    .text-input,.price-input { width:100%; font-size:1rem; padding:10px; border:1px solid var(--border); border-radius:10px; }
    .add-row { display:flex; gap:12px; }
    .btn { border:none; border-radius:12px; padding:12px; font-weight:700; cursor:pointer; }
    .btn-wide { flex:1; display:grid; grid-template-columns:1fr 1fr; background:var(--accent); color:#fff; }
    .tools-row { margin-top:10px; }
    .btn-outline { background:#fff; color:var(--accent); border:2px solid var(--accent); }
    .keypad { position:relative; display:grid; grid-template-columns:repeat(3,1fr); gap:10px; margin:14px 0; padding:20px; background:var(--green); border-radius:12px; }
    .key { background:#fff; border:1px solid var(--border); border-radius:10px; padding:14px; text-align:center; font-size:1.25rem; font-weight:700; cursor:pointer; }
    footer { margin-top:auto; background:#fff; border-top:1px solid var(--border); }
    .list-item { display:grid; grid-template-columns:1fr 5fr 2fr; gap:8px; padding:10px; border-bottom:1px solid #eee; cursor:pointer; }
    .modal-backdrop { position:fixed; inset:0; background:rgba(0,0,0,0.35); display:none; align-items:center; justify-content:center; }
    .modal { background:#fff; border-radius:12px; padding:16px; max-width:360px; width:100%; }
    .state-green{color:var(--green);} .state-yellow{color:var(--yellow);} .state-red{color:var(--red);}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="title">
        <span>LimiteCalc</span>
        <span class="cart-icon">
          <!-- Carrinho preto com símbolos matemáticos -->
          <svg viewBox="0 0 24 24" width="40" height="40" fill="black">
            <path d="M7 18a2 2 0 1 0 0 4 2 2 0 0 0 0-4zm10 0a2 2 0 1 0 0 4 2 2 0 0 0 0-4zM6 6h13l-1.5 6h-9.9l-.6-3H4V6h2z"/>
            <text x="5" y="12" font-size="8" fill="black">+</text>
            <text x="12" y="12" font-size="8" fill="black">−</text>
            <text x="18" y="12" font-size="8" fill="black">×</text>
            <text x="22" y="12" font-size="8" fill="black">÷</text>
          </svg>
        </span>
      </div>
      <div id="totalLine" class="total-line state-green">
        TOTAL GERAL: R$ <span id="totalValue">0,00</span>
      </div>
    </header>

    <section class="limit-area">
      <div class="card">
        <div class="card-title">Meu Limite</div>
        <input id="limitInput" class="limit-input" maxlength="4" inputmode="numeric"/>
      </div>
      <div class="card">
        <div class="card-title">Progresso</div>
        <div class="progress-bar"><div id="progressFill" class="progress-fill"></div></div>
      </div>
    </section>

    <section class="inputs-row">
      <input id="productInput" class="text-input" placeholder="Nome do produto"/>
      <input id="priceInput" class="price-input" placeholder="Preço" inputmode="decimal"/>
    </section>

    <section class="add-row">
      <button id="addBtn" class="btn btn-wide">
        <span class="minus">–</span>
        <span>Adicionar</span>
        <span class="plus">+</span>
      </button>
    </section>

    <section class="tools-row">
      <button id="scanBtn" class="btn btn-outline">Capturar etiqueta</button>
    </section>

    <section class="keypad">
      <div class="key">1</div><div class="key">2</div><div class="key">3</div>
      <div class="key">4</div><div class="key">5</div><div class="key">6</div>
      <div class="key">7</div><div class="key">8</div><div class="key">9</div>
      <div class="key">0</div><div class="key" data-action="comma">,</div><div class="key" data-action="back">⌫</div>
    </section>
  </div>

  <footer><div id="list"></div></footer>

  <div id="modalBackdrop" class="modal-backdrop">
    <div class="modal">
      <h4>Deseja deletar o item?</h4>
      <p id="modalText"></p>
      <button id="modalNo" class="btn btn-outline">Não</button>
      <button id="modalYes" class="btn">Sim</button>
    </div>
  </div>

  <!-- OCR -->
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4/dist/tesseract.min.js"></script>
  <script>
    const productInput = document.getElementById('productInput');
    const priceInput = document.getElementById('priceInput');
    const list = document.getElementById('list');
    const totalValue = document.getElementById('totalValue');
    const progressFill = document.getElementById('progressFill');
    const limitInput = document.getElementById('limitInput');
    const scanBtn = document.getElementById('scanBtn');
    const video = document.createElement('video');
    const canvas = document.createElement('canvas');
    let mediaStream = null;

    const state = { items: [], limit: 0 };

    function parsePrice(str) {
      return parseFloat(str.replace(',', '.')) || 
